{% extends 'layouts/admin_base.html' %}

{% block title %}Admin - Demandes{% endblock %}
{% block page_title %}Demandes{% endblock %}

{% block admin_content %}
<div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <div>
        <h1 class="text-2xl font-bold text-white">Gestion des demandes</h1>
        <p class="text-gray-400 mt-1">{{ requests|length }} demande(s) au total</p>
    </div>
    
    <div class="flex items-center gap-3">
        <div class="relative">
            <select onchange="window.location.href='?status=' + this.value" 
                    class="appearance-none bg-slate-800 border border-slate-600 rounded-xl px-4 py-2.5 pr-10 text-white text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                <option value="all" {% if current_filter == 'all' %}selected{% endif %}>Tous les statuts</option>
                {% for code, label in statuses %}
                <option value="{{ code }}" {% if current_filter == code %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
            <svg class="w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
        </div>
    </div>
</div>

{% if requests %}
<div class="bg-slate-800 rounded-2xl border border-slate-700 overflow-hidden">
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead>
                <tr class="border-b border-slate-700">
                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">ID</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Titre</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Client</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Statut</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Progression</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Date</th>
                    <th class="px-6 py-4 text-right text-xs font-semibold text-gray-400 uppercase tracking-wider">Actions</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-slate-700">
                {% for req in requests %}
                <tr class="hover:bg-slate-700/30 transition-colors">
                    <td class="px-6 py-4">
                        <span class="text-gray-400 font-mono text-sm">#{{ req.id }}</span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="max-w-xs">
                            <p class="text-white font-medium truncate">{{ req.title }}</p>
                            <p class="text-gray-500 text-sm">{{ req.get_service_display() }}</p>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full gradient-bg flex items-center justify-center flex-shrink-0">
                                <span class="text-white text-xs font-bold">{{ req.user.first_name[0] }}{{ req.user.last_name[0] }}</span>
                            </div>
                            <div>
                                <p class="text-white text-sm">{{ req.user.full_name }}</p>
                                <p class="text-gray-500 text-xs">{{ req.user.email }}</p>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <span class="px-2.5 py-1 rounded-lg text-xs font-medium status-{{ req.status }}">
                            {{ req.get_status_display() }}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-2">
                            <div class="w-20 h-2 bg-slate-700 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-primary-500 to-accent-500 rounded-full transition-all" style="width: {{ req.progress_percentage }}%"></div>
                            </div>
                            <span class="text-gray-400 text-xs">{{ req.progress_percentage }}%</span>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <p class="text-gray-400 text-sm">{{ req.created_at.strftime('%d/%m/%Y') }}</p>
                        {% if req.deadline %}
                        <p class="text-gray-500 text-xs">Deadline: {{ req.deadline.strftime('%d/%m') }}</p>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 text-right">
                        <a href="{{ url_for('admin.view_request', request_id=req.id) }}" 
                           class="inline-flex items-center px-3 py-1.5 bg-primary-600/20 text-primary-400 rounded-lg text-sm font-medium hover:bg-primary-600/30 transition-colors">
                            Voir
                            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% else %}
<div class="bg-slate-800 rounded-2xl border border-slate-700 p-12 text-center">
    <svg class="w-16 h-16 mx-auto mb-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
    </svg>
    <h3 class="text-xl font-semibold text-white mb-2">Aucune demande</h3>
    <p class="text-gray-400">
        {% if current_filter != 'all' %}
        Aucune demande avec ce statut.
        <a href="{{ url_for('admin.requests_list') }}" class="text-primary-400 hover:text-primary-300">Voir toutes les demandes</a>
        {% else %}
        Les demandes des clients apparaitront ici.
        {% endif %}
    </p>
</div>
{% endif %}
{% endblock %}
